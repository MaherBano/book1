# Data Model: Frontend Integration & Local Connectivity

## Entities

### Query Request
**Description**: A user's question submitted to the backend, including the question text and optional context information (current page, selected text)

**Fields**:
- `message` (string, required): The user's question or message to the chatbot
- `context_constraint` (string, optional): Optional context information such as current page or selected text
- `session_id` (string, optional): ID of the current chat session for conversation history

**Validation Rules**:
- `message` must be between 1 and 2000 characters
- `context_constraint` must be less than 500 characters if provided
- `session_id` must be a valid UUID format if provided

### Response
**Description**: The backend's answer to the query, including the response text and references to relevant book sections

**Fields**:
- `response` (string, required): The AI-generated response to the user's query
- `citations` (array of Citation objects, required): List of sources referenced in the response
- `confidence_score` (number, required): Confidence score between 0 and 1 indicating how confident the AI is in its response
- `query_id` (string, required): Unique identifier for the query
- `timestamp` (string, required): ISO 8601 formatted timestamp of when the response was generated

**Validation Rules**:
- `response` must not be empty
- `confidence_score` must be between 0 and 1
- `query_id` must be a unique identifier
- `citations` may be an empty array if no sources were used

### Citation
**Description**: A reference to a specific section of the book that was used to generate the response

**Fields**:
- `url` (string, required): URL or path to the referenced content
- `chapter` (string, required): The chapter title of the referenced content
- `section` (string, required): The specific section within the chapter
- `content_preview` (string, required): A short preview of the referenced content
- `relevance_score` (number, required): Score between 0 and 1 indicating how relevant this citation is to the query

**Validation Rules**:
- `url` must be a valid URL or relative path
- `relevance_score` must be between 0 and 1
- `content_preview` must be less than 500 characters

### Chat Session
**Description**: A temporary conversation context that maintains the history of interactions during a single user session

**Fields**:
- `session_id` (string, required): Unique identifier for the chat session
- `history` (array of ChatHistoryItem objects, required): List of previous interactions in this session
- `created_at` (string, required): ISO 8601 formatted timestamp of when the session was created
- `last_interaction` (string, required): ISO 8601 formatted timestamp of the last interaction

**Validation Rules**:
- `session_id` must be a valid UUID
- `history` may be empty for new sessions
- `created_at` must be before or equal to `last_interaction`

### Chat History Item
**Description**: A single interaction in a chat session history

**Fields**:
- `query` (string, required): The user's question in this interaction
- `response` (string, required): The AI's response to the query
- `timestamp` (string, required): ISO 8601 formatted timestamp of the interaction

**Validation Rules**:
- Both `query` and `response` must not be empty
- `timestamp` must be in valid ISO 8601 format

## State Transitions

### Query Request
- **Initial State**: Created when user submits a question through the chat interface
- **Processed State**: Transmitted to the backend API for processing
- **Final State**: Either processed successfully or results in an error

### Response
- **Initial State**: Generated by the RAG agent after processing the query
- **Transmitted State**: Sent from backend to frontend via API
- **Final State**: Displayed in the chat interface to the user

### Chat Session
- **Initial State**: Created when a new conversation begins
- **Active State**: Updated with each new interaction
- **Inactive State**: Session expires after period of inactivity or when explicitly closed